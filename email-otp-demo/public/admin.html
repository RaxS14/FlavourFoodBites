<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard ‚Äî Customer Service</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">

<style>
* {margin:0;padding:0;box-sizing:border-box;}
body {
  font-family:'Poppins',sans-serif;
  background:#0F0F23;color:#fff;
  display:flex;height:100vh;overflow:hidden;
}
/* Sidebar */
.sidebar {
  width:260px;background:#1a1a3a;padding:2rem 1rem;
  display:flex;flex-direction:column;align-items:center;
  position:fixed;height:100%;box-shadow:2px 0 15px rgba(0,0,0,0.2);
}
.sidebar img {width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:0.5rem;}
.sidebar h2 {font-size:1.3rem;color:#FF6B35;}
.sidebar p {color:#aaa;margin-bottom:2rem;font-size:0.9rem;}
.sidebar ul {list-style:none;width:100%;}
.sidebar li {margin:0.3rem 0;}
.sidebar a {
  display:flex;align-items:center;gap:10px;
  text-decoration:none;color:#fff;padding:0.7rem 1rem;
  border-radius:10px;transition:0.3s;
}
.sidebar a.active,.sidebar a:hover {background:#FF6B35;font-weight:600;}
/* Main */
main {
  flex:1;margin-left:260px;padding:2rem;
  overflow-y:auto;display:flex;flex-direction:column;
}
header {
  background:#1a1a3a;border-radius:12px;padding:1rem 1.5rem;margin-bottom:1rem;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);display:flex;justify-content:space-between;align-items:center;
}
header h1 {font-size:1.5rem;}
.refresh-indicator {
  background:rgba(255,255,255,0.2);padding:0.4rem 0.8rem;
  border-radius:10px;font-size:0.9rem;animation:pulse 2s infinite;
}
@keyframes pulse {0%,100%{opacity:0.6;}50%{opacity:1;}}
section {margin-bottom:2rem;}
h2 {
  font-size:1.3rem;color:#FF6B35;border-bottom:3px solid #FF8C69;
  display:inline-block;padding-bottom:0.3rem;margin-bottom:1rem;
}
/* Cards */
.card {
  background:#1a1a3a;border-radius:20px;padding:1rem;margin-bottom:1rem;
  box-shadow:0 10px 25px rgba(255,107,53,0.3);transition:transform 0.2s;
}
.card:hover {transform:scale(1.02);}
.card h3 {color:#FF6B35;margin-bottom:0.2rem;}
.card p {margin-bottom:0.3rem;font-size:0.95rem;color:#ccc;}
.card button {
  border:none;border-radius:8px;padding:6px 10px;cursor:pointer;transition:background 0.3s;
}
.card .contact-btn {background:#444;color:#fff;margin-top:6px;}
.card .contact-btn:hover {background:#666;}
.card .remove-btn {background:#FF6B35;color:#fff;float:right;}
.card .remove-btn:hover {background:#ff8450;}
/* Floating Chat Box */
.chat-popup {
  position:fixed;bottom:20px;right:20px;width:320px;height:420px;background:#1a1a3a;
  border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.5);
  display:none;flex-direction:column;overflow:hidden;z-index:10000;
}
.chat-popup header {
  background:#FF6B35;padding:0.8rem;display:flex;justify-content:space-between;align-items:center;color:#fff;
}
.chat-popup header h3 {font-size:1rem;}
.chat-popup header button {background:none;border:none;color:#fff;font-size:1.2rem;cursor:pointer;}
.chat-container {flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;}
.chat-message {
  padding:8px 12px;border-radius:12px;max-width:80%;font-size:0.95rem;
}
.chat-message.customer {background:#2b2b3a;align-self:flex-start;}
.chat-message.admin {background:#FF6B35;align-self:flex-end;}
.chat-time {font-size:0.7rem;color:#aaa;margin-top:2px;text-align:right;}
.chat-input {display:flex;gap:5px;padding:8px;background:#0F0F23;}
.chat-input input {
  flex:1;padding:8px 12px;border-radius:12px;border:none;background:#1a1a3a;color:#fff;
}
.chat-input button {
  padding:8px 12px;border:none;border-radius:12px;background:#FF6B35;color:#fff;cursor:pointer;
}
.chat-input button:hover {background:#ff8256;}
/* Notification */
#notification {
  position:fixed;top:20px;right:20px;background:#FF6B35;color:#fff;
  padding:12px 16px;border-radius:8px;display:none;box-shadow:0 4px 10px rgba(0,0,0,0.3);
  z-index:9999;animation:slideIn 0.3s ease-out;
}
@keyframes slideIn {from{transform:translateY(-10px);opacity:0;}to{transform:translateY(0);opacity:1;}}
/* Collapsible Reviews */
.reviews-header {cursor:pointer;display:flex;align-items:center;gap:8px;color:#FF6B35;user-select:none;}
.reviews-header i {transition:transform 0.3s;}
.reviews-header.active i {transform:rotate(180deg);}
#reviewsContainer {display:none;flex-direction:column;gap:10px;margin-top:10px;}
/* Responsive */
@media(max-width:768px){
  .chat-popup {width:90%;right:5%;bottom:10px;}
  body {flex-direction:column;}
  .sidebar {width:100%;flex-direction:row;justify-content:space-around;padding:1rem;height:auto;}
  main {margin-left:0;padding:1rem;}
}
</style>
</head>

<body>
<!-- Sidebar -->
<aside class="sidebar">
  <img src="images/admin-avatar.png" alt="Admin Avatar">
  <h2>Admin</h2>
  <p>Administrator</p>
  <ul>
    <li><a href="#" class="active"><i class="ri-dashboard-line"></i> Dashboard</a></li>
    <li><a href="#"><i class="ri-shopping-bag-3-line"></i> Orders</a></li>
    <li><a href="#"><i class="ri-archive-2-line"></i> Inventory</a></li>
    <li><a href="#"><i class="ri-truck-line"></i> Suppliers</a></li>
    <li><a href="#"><i class="ri-bar-chart-2-line"></i> Reports</a></li>
    <li><a href="#" id="logoutLink"><i class="ri-logout-circle-line"></i> Logout</a></li>
  </ul>
</aside>

<!-- Main -->
<main>
  <header>
    <h1>Customer Service Dashboard</h1>
    <span class="refresh-indicator">Live updates üîÑ</span>
  </header>

  <div id="notification"></div>

  <section>
    <h2>Tickets</h2>
    <div id="ticketsContainer"></div>
  </section>

  <section>
    <div class="reviews-header" id="reviewsToggle">
      <i class="ri-arrow-down-s-line"></i>
      <h2>Customer Reviews</h2>
    </div>
    <div id="reviewsContainer"></div>
  </section>
</main>

<!-- Floating Chat Popup -->
<div class="chat-popup" id="chatPopup">
  <header>
    <h3 id="chatTitle">Chat</h3>
    <button id="closeChat"><i class="ri-close-line"></i></button>
  </header>
  <div id="chatBox" class="chat-container"></div>
  <div class="chat-input">
    <input id="adminMessage" type="text" placeholder="Type a message...">
    <button id="sendBtn">Send</button>
  </div>
</div>

<script>
const el = {
  tickets: document.getElementById('ticketsContainer'),
  chatPopup: document.getElementById('chatPopup'),
  chatBox: document.getElementById('chatBox'),
  adminMsg: document.getElementById('adminMessage'),
  sendBtn: document.getElementById('sendBtn'),
  notif: document.getElementById('notification'),
  reviews: document.getElementById('reviewsContainer'),
  toggle: document.getElementById('reviewsToggle'),
  chatTitle: document.getElementById('chatTitle')
};

let tickets = JSON.parse(localStorage.getItem('tickets') || '[]');
let activeTicketId = null;

const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
const load = (k) => JSON.parse(localStorage.getItem(k) || '[]');

function notify(msg) {
  el.notif.textContent = msg;
  el.notif.style.display = 'block';
  setTimeout(()=>el.notif.style.display='none',3000);
}

function renderTickets(){
  el.tickets.innerHTML = tickets.length ? '' : '<p>No tickets yet.</p>';
  tickets.forEach(t=>{
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <h3>${t.name} - ${t.subject}</h3>
      <p><strong>Email:</strong> ${t.email}</p>
      <p><strong>Message:</strong> ${t.message}</p>
      <button class="contact-btn" data-id="${t.id}">üí¨ Contact</button>
      <button class="remove-btn" data-id="${t.id}">üóë Remove</button>
    `;
    el.tickets.appendChild(card);
  });

  el.tickets.querySelectorAll('.contact-btn').forEach(b=>b.onclick=()=>{
    activeTicketId=b.dataset.id;
    const t=tickets.find(x=>x.id==activeTicketId);
    el.chatTitle.textContent=`Chat ‚Äî ${t.name}`;
    el.chatPopup.style.display='flex';
    renderChat();
  });

  el.tickets.querySelectorAll('.remove-btn').forEach(b=>b.onclick=()=>{
    tickets=tickets.filter(t=>t.id!=b.dataset.id);
    save('tickets',tickets);
    renderTickets();
  });
}

function renderChat(){
  if(!activeTicketId)return;
  const chatKey='live_chat_'+activeTicketId;
  const chat=load(chatKey);
  el.chatBox.innerHTML=chat.length?'':'<p>No messages yet.</p>';
  chat.forEach(msg=>{
    const div=document.createElement('div');
    div.className=`chat-message ${msg.sender}`;
    div.innerHTML=`${msg.text}<div class="chat-time">${new Date(msg.time).toLocaleTimeString()}</div>`;
    el.chatBox.appendChild(div);
  });

  // ‚úÖ Show review when chat ends
  const status=localStorage.getItem('chat_status_'+activeTicketId);
  if(status==='ended'){
    const reviewKey='chat_review_'+activeTicketId;
    const review=JSON.parse(localStorage.getItem(reviewKey)||'null');
    if(review){
      const line=document.createElement('div');
      line.style.textAlign='center';
      line.style.color='#aaa';
      line.style.margin='10px 0';
      line.innerHTML='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Chat Ended ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ';
      el.chatBox.appendChild(line);

      const reviewDiv=document.createElement('div');
      reviewDiv.className='chat-message customer';
      reviewDiv.style.textAlign='center';
      reviewDiv.style.opacity='0.8';
      reviewDiv.innerHTML=`‚≠ê Rated ${review.rating}/5<br>"${review.feedback||'No feedback.'}"`;
      el.chatBox.appendChild(reviewDiv);
    }
  }

  el.chatBox.scrollTop=el.chatBox.scrollHeight;
}

el.sendBtn.onclick=()=>{
  if(!activeTicketId)return alert("Select a ticket first.");
  const text=el.adminMsg.value.trim();
  if(!text)return;
  const chatKey='live_chat_'+activeTicketId;
  const chat=load(chatKey);
  chat.push({sender:'admin',text,time:Date.now()});
  save(chatKey,chat);
  el.adminMsg.value='';
  renderChat();
};

document.getElementById('closeChat').onclick=()=>{
  el.chatPopup.style.display='none';
  activeTicketId=null;
};

// Collapsible Reviews
el.toggle.onclick=()=>{
  el.toggle.classList.toggle('active');
  el.reviews.style.display=el.reviews.style.display==='flex'?'none':'flex';
};

function renderReviews(){
  const reviews=Object.keys(localStorage)
    .filter(k=>k.startsWith('chat_review_'))
    .map(k=>JSON.parse(localStorage.getItem(k)));
  el.reviews.innerHTML=reviews.length?'':'<p>No customer reviews yet.</p>';
  reviews.sort((a,b)=>b.date-a.date);
  reviews.forEach(r=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`
      <h3>${r.name||'Anonymous'}</h3>
      <p>‚≠ê ${'‚òÖ'.repeat(r.rating)} (${r.rating}/5)</p>
      <p>${r.feedback||'No feedback provided.'}</p>
      <p style="font-size:0.8rem;color:#aaa;">${new Date(r.date).toLocaleString()}</p>
    `;
    el.reviews.appendChild(div);
  });
}

// ‚úÖ Live sync between tabs
window.addEventListener('storage',(e)=>{
  if(e.key?.startsWith('chat_status_')){
    const id=e.key.replace('chat_status_','');
    if(e.newValue==='ended'){
      const t=tickets.find(x=>x.id==id);
      notify(`‚ö†Ô∏è ${t?.name||'A customer'} ended the chat.`);
      if(id===activeTicketId)renderChat();
      renderReviews();
    }
  }
  if(e.key?.startsWith('live_chat_')&&e.key==='live_chat_'+activeTicketId){
    renderChat();
  }
  if(e.key?.startsWith('chat_review_')) renderReviews();
});

setInterval(()=>{
  tickets=JSON.parse(localStorage.getItem('tickets'))||[];
  renderTickets();
  if(activeTicketId)renderChat();
},2000);

renderTickets();
renderReviews();
</script>
</body>
</html>
