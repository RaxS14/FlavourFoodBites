<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shopping Cart - Flavour Food Bites</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
:root {
  --primary:#FF6B35; --secondary:#2C3E50; --bg:#0F0F23; --bg-light:#1a1a3a;
  --text:#fff; --text-secondary:#B8BCC8; --glass: rgba(255,255,255,0.1);
  --glass-border: rgba(255,255,255,0.2);
  --gradient-primary: linear-gradient(135deg,#FF6B35 0%,#E55A2B 50%,#FF8A50 100%);
  --gradient-secondary: linear-gradient(135deg,#3498DB 0%,#2980B9 100%);
}

* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter',sans-serif; background: var(--bg); color: var(--text); overflow-x:hidden; }
body::before {
  content:''; position:fixed; top:0; left:0; width:100%; height:100%;
  background: radial-gradient(circle at 20% 80%, rgba(255,107,53,0.15) 0%, transparent 50%),
              radial-gradient(circle at 80% 20%, rgba(52,152,219,0.15) 0%, transparent 50%),
              radial-gradient(circle at 40% 40%, rgba(39,174,96,0.1) 0%, transparent 50%),
              linear-gradient(135deg,#0F0F23 0%,#1a1a3a 100%);
  z-index:-2;
}

/* Header */
header { position:fixed; top:0; left:0; right:0; background:rgba(15,15,35,0.9); backdrop-filter:blur(20px); border-bottom:1px solid var(--glass-border); z-index:1000; }
.navbar { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; max-width:1400px; margin:0 auto; }
.logo-section { display:flex; align-items:center; gap:1rem; }
.logo { width:60px; height:60px; background:var(--gradient-primary); border-radius:16px; display:flex; justify-content:center; align-items:center; color:#fff; font-size:1.8rem; font-weight:bold; box-shadow:0 0 40px rgba(255,107,53,0.3); }
.brand-name { font-size:1.8rem; font-weight:800; background:var(--gradient-primary); -webkit-background-clip:text; -webkit-text-fill-color:transparent; letter-spacing:-1px; }
.nav-links { display:flex; list-style:none; gap:2rem; }
.nav-links a { text-decoration:none; color:var(--text-secondary); font-weight:600; padding:0.75rem 1.5rem; border-radius:12px; transition:0.3s; }
.nav-links a:hover, .nav-links a.active { color:var(--text); transform:translateY(-2px); }

/* Cart Layout */
.cart-container { max-width:1200px; margin:0 auto; padding:120px 2rem 4rem; display:grid; grid-template-columns:2fr 1fr; gap:3rem; }
.cart-header { grid-column:1/-1; text-align:center; margin-bottom:3rem; }
.cart-title { font-size:clamp(2.5rem,5vw,4rem); font-weight:900; background:var(--gradient-primary); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:0.5rem; letter-spacing:-2px; }
.cart-subtitle { font-size:1.2rem; color:var(--text-secondary); }

.cart-items-section, .cart-summary-section { background:var(--glass); backdrop-filter:blur(20px); border:1px solid var(--glass-border); border-radius:24px; padding:2rem; height:fit-content;}
.cart-items { display:flex; flex-direction:column; gap:1.5rem; }

.cart-item { background:var(--bg-light); border:1px solid var(--glass-border); border-radius:16px; padding:1.5rem; transition:0.3s; }
.cart-item:hover { transform:translateX(8px); border-color:var(--primary); box-shadow:0 10px 30px rgba(255,107,53,0.2); }
.item-header { display:flex; justify-content:space-between; margin-bottom:1rem; }
.item-info h3 { font-size:1.3rem; font-weight:700; color:var(--text); margin-bottom:0.5rem; }
.item-info p { color:var(--text-secondary); font-size:0.9rem; }
.item-price { font-size:1.5rem; font-weight:800; color:var(--primary); }
.item-controls { display:flex; justify-content:space-between; align-items:center; margin-top:1rem; }
.quantity-controls { display:flex; align-items:center; background:var(--glass); border-radius:50px; padding:0.5rem; border:1px solid var(--glass-border);}
.quantity-btn { width:40px;height:40px;border:none;background:var(--glass);color:var(--text);border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:600;font-size:1.2rem; transition:0.3s; }
.quantity-btn:hover { background:var(--primary); transform:scale(1.1); }
.quantity-display { min-width:60px; text-align:center; font-weight:700; font-size:1.2rem; color:var(--text); }
.remove-btn { background:#E74C3C; color:#fff; border:none; padding:0.75rem 1.5rem; border-radius:50px; cursor:pointer; font-weight:600; display:flex; align-items:center; gap:0.5rem; transition:0.3s;}
.remove-btn:hover { transform:translateY(-2px); box-shadow:0 10px 30px rgba(231,76,60,0.4); }

.empty-cart { text-align:center; padding:4rem 2rem; color:var(--text-secondary);}
.empty-icon { font-size:5rem; color:#B8BCC8; margin-bottom:2rem;}
.empty-title { font-size:2rem; font-weight:700; color:var(--text); margin-bottom:1rem;}
.empty-description { font-size:1.1rem; line-height:1.6; margin-bottom:2rem; }
.continue-shopping { background:var(--gradient-primary); color:#fff; text-decoration:none; padding:1.25rem 2.5rem; border-radius:50px; font-weight:700; display:inline-flex; align-items:center; gap:0.75rem; transition:0.3s;}
.continue-shopping:hover { transform:translateY(-3px); box-shadow:0 15px 40px rgba(255,107,53,0.4); }

.summary-item { display:flex; justify-content:space-between; padding:1rem 0; border-bottom:1px solid var(--glass-border);}
.summary-item:last-child { border:none; font-size:1.5rem; font-weight:800; color:var(--primary); padding-top:1.5rem; margin-top:1rem; border-top:2px solid var(--glass-border); }
.summary-label { font-weight:600; color:var(--text-secondary); }
.summary-value { font-weight:700; color:var(--text); }

.checkout-btn, .location-btn {
  width:100%; border:none; padding:1.25rem; border-radius:16px; font-weight:700; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:0.75rem; transition:0.3s;
}
.location-btn { background:var(--gradient-secondary); color:#fff; margin-top:1rem; }
.location-btn:hover { transform:translateY(-2px); box-shadow:0 10px 30px rgba(52,152,219,0.3);}
.checkout-btn { background:var(--gradient-primary); color:#fff; margin-top:1rem; font-size:1.2rem;}
.checkout-btn:hover { transform:translateY(-3px); box-shadow:0 15px 40px rgba(255,107,53,0.4);}

/* Modals */
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:2000; justify-content:center; align-items:center; }
.modal .modal-content { background:#1a1a3a; padding:2rem; border-radius:24px; max-width:500px; width:90%; text-align:center; color:#fff; position:relative; }
.modal .modal-content h2 { margin-bottom:1rem; }
.modal .close-btn { position:absolute; top:1rem; right:1.5rem; font-size:1.5rem; cursor:pointer; }
#map { width:100%; height:400px; border-radius:16px; margin-top:1rem; }
#selected-location { margin-top:1rem; font-size:1rem; color:#B8BCC8; }
#gcash-preview img { width:80px; height:80px; border-radius:12px; object-fit:cover; border:1px solid rgba(255,107,53,0.3);}
</style>
</head>
<body>

<header>
  <nav class="navbar">
    <div class="logo-section">
      <div class="logo"><i class="fas fa-utensils"></i></div>
      <span class="brand-name">Flavour Food Bites</span>
    </div>
    <ul class="nav-links">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="menu.html"><span>Menu</span></a></li>
      <li><a href="lcart.html" class="active"><span>Cart</span></a></li>
      <li><a href="orders.html"><span>Orders</span></a></li>
      <li><a href="reviews.html"><span>Reviews</span></a></li>
      <li><a href="aboutus.html">About Us</a></li>
      <li><a href="customerService.html"><span>Customer Service</span></a></li>
      <li><a href="login.html"><span>Logout</span></a></li>
    </ul>
  </nav>
</header>

<main class="cart-container">
  <div class="cart-header">
    <h1 class="cart-title">Your Cart</h1>
    <p class="cart-subtitle">Review your items and proceed to checkout</p>
  </div>

  <section class="cart-items-section">
    <h2 class="section-title"><i class="fa-solid fa-bag-shopping"></i> Cart Items</h2>
    <div class="cart-items"></div>
  </section>

  <section class="cart-summary-section">
    <h2 class="section-title"><i class="fa-solid fa-list-check"></i> Order Summary</h2>
    <div class="summary-item"><span class="summary-label">Subtotal</span><span class="summary-value" id="subtotal">₱0.00</span></div>
    <div class="summary-item"><span class="summary-label">Delivery Fee</span><span class="summary-value" id="delivery">₱0.00</span></div>
    <div class="summary-item"><span class="summary-label">Total</span><span class="summary-value" id="total">₱0.00</span></div>
    <button class="location-btn" id="select-location"><i class="fa-solid fa-location-dot"></i> Select Delivery Location</button>
    <button class="checkout-btn" id="checkout-btn"><i class="fa-solid fa-credit-card"></i> Proceed to Checkout</button>
  </section>
</main>

<!-- Delivery Modal -->
<div id="delivery-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="close-location">&times;</span>
    <h2>Select Delivery Location</h2>
    <div id="map"></div>
    <div id="selected-location">Selected: None</div>
    <button id="confirm-location" style="margin-top:1rem;">Confirm Location</button>
  </div>
</div>

<!-- Checkout Modal -->
<div id="checkout-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Checkout</h2>

    <!-- New Customer Info Fields -->
    <div style="margin-bottom:1rem; text-align:left;">
      <label for="customer-name" style="display:block; margin-bottom:0.25rem;">Full Name</label>
      <input type="text" id="customer-name" placeholder="Enter your full name" style="width:100%; padding:0.75rem; border-radius:8px; border:1px solid #555; background:#1a1a3a; color:#fff;">
    </div>
    <div style="margin-bottom:1rem; text-align:left;">
      <label for="customer-contact" style="display:block; margin-bottom:0.25rem;">Contact Number</label>
      <input type="text" id="customer-contact" placeholder="Enter your contact number" style="width:100%; padding:0.75rem; border-radius:8px; border:1px solid #555; background:#1a1a3a; color:#fff;">
    </div>

    <select id="modal-payment-method">
      <option value="">Select Payment Method</option>
      <option value="COD">Cash on Delivery (COD)</option>
      <option value="GCash">GCash</option>
    </select>

    <div id="gcash-info" style="display:none; margin-top:1rem; text-align:left;">
      <h3 style="color:#FF6B35;">Pay to Seller</h3>
      <p><strong>Name:</strong> Raxcel L.</p>
      <p><strong>Number:</strong> 09560351994</p>
      <p style="color:#B8BCC8; margin-top:0.5rem;">Scan the QR code below to pay via GCash</p>
      <img src="images/gcash-qr.jpg" alt="GCash QR Code" style="width:80px; height:80px; border-radius:12px; object-fit:cover; border:1px solid rgba(255,107,53,0.3);">
      <p style="margin-top:1rem;">Upload Receipt (1–2 images)</p>
      <input type="file" id="gcash-receipt" accept="image/*" multiple>
      <div id="gcash-preview" style="display:flex; gap:10px; margin-top:0.5rem;"></div>
    </div>

    <button id="confirm-checkout" style="margin-top:1rem;">Confirm Order</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ===== Business Location =====
const BUSINESS_LAT = 10.2583;
const BUSINESS_LNG = 123.8167;

// ===== Cart Logic =====
const cartItemsContainer = document.querySelector('.cart-items');
const summaryContainer = document.querySelector('.cart-summary-section');
const DELIVERY_FEE = 30;
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function renderCart() {
  cartItemsContainer.innerHTML='';
  if(cart.length===0){
    cartItemsContainer.innerHTML=`<div class="empty-cart"><i class="fas fa-cart-shopping empty-icon"></i><div class="empty-title">Your cart is empty</div><div class="empty-description">Add some delicious meals to your cart!</div><a href="menu.html" class="continue-shopping"><i class="fas fa-utensils"></i> Continue Shopping</a></div>`;
    summaryContainer.style.display='none';
    return;
  }
  summaryContainer.style.display='block';
  cart.forEach(item=>{
    const div=document.createElement('div');
    div.classList.add('cart-item');
    div.innerHTML=`
      <div class="item-header">
        <div class="item-info">
          <h3>${item.name}</h3>
          <p>${item.qty}x</p>
        </div>
        <div class="item-price">₱${(item.price*item.qty).toFixed(2)}</div>
      </div>
      <div class="item-controls">
        <div class="quantity-controls">
          <button class="quantity-btn minus">-</button>
          <div class="quantity-display">${item.qty}</div>
          <button class="quantity-btn plus">+</button>
        </div>
        <button class="remove-btn"><i class="fa-solid fa-trash"></i> Remove</button>
      </div>`;
    div.querySelector('.quantity-btn.minus').addEventListener('click', ()=>{ if(item.qty>1)item.qty--; else removeItem(item.id); saveAndRender(); });
    div.querySelector('.quantity-btn.plus').addEventListener('click', ()=>{ item.qty++; saveAndRender(); });
    div.querySelector('.remove-btn').addEventListener('click', ()=>{ removeItem(item.id); saveAndRender(); });
    cartItemsContainer.appendChild(div);
  });
  updateSummary();
}

function updateSummary(){
  const subtotal=cart.reduce((acc,item)=>acc+item.price*item.qty,0);
  document.getElementById('subtotal').textContent=`₱${subtotal.toFixed(2)}`;
  document.getElementById('delivery').textContent=`₱${DELIVERY_FEE.toFixed(2)}`;
  document.getElementById('total').textContent=`₱${(subtotal+DELIVERY_FEE).toFixed(2)}`;
}

function removeItem(id){ cart = cart.filter(i=>i.id!==id); }
function saveAndRender(){ localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); }
renderCart();

// ===== Delivery Modal =====
const deliveryModal = document.getElementById('delivery-modal');
const selectLocationBtn = document.getElementById('select-location');
const closeLocationBtn = document.getElementById('close-location');
const confirmLocationBtn = document.getElementById('confirm-location');
const selectedLocationDisplay = document.getElementById('selected-location');
let selectedCoords = null;
let map, marker;

selectLocationBtn.addEventListener('click', () => {
  deliveryModal.style.display='flex';
  if(!map){
    map = L.map('map').setView([BUSINESS_LAT,BUSINESS_LNG],15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'&copy; OpenStreetMap contributors' }).addTo(map);
    marker = L.marker([BUSINESS_LAT,BUSINESS_LNG],{ draggable:true }).addTo(map);
    marker.bindPopup("<b>Flavour Food Bites</b><br>Colis Street, Tabunok Market, Talisay, Cebu").openPopup();
    marker.on('drag', e=>{ selectedCoords=e.target.getLatLng(); updateSelectedDisplay(); });
    selectedCoords = marker.getLatLng(); updateSelectedDisplay();
  }
});

closeLocationBtn.addEventListener('click', ()=>{ deliveryModal.style.display='none'; });
confirmLocationBtn.addEventListener('click', ()=>{
  if(selectedCoords){
    localStorage.setItem('deliveryLocation', JSON.stringify({lat:selectedCoords.lat,lng:selectedCoords.lng}));
    alert(`Delivery location set to: ${selectedCoords.lat.toFixed(6)}, ${selectedCoords.lng.toFixed(6)}`);
  }
  deliveryModal.style.display='none';
});
function updateSelectedDisplay(){ selectedLocationDisplay.textContent=`Selected: ${selectedCoords.lat.toFixed(6)}, ${selectedCoords.lng.toFixed(6)}`; }

// ===== Checkout Logic =====
const checkoutModal = document.getElementById('checkout-modal');
const checkoutBtn = document.getElementById('checkout-btn');
const closeCheckout = checkoutModal.querySelector('.close-btn');
const modalPayment = document.getElementById('modal-payment-method');
const gcashInfo = document.getElementById('gcash-info');
const receiptInput = document.getElementById('gcash-receipt');
const receiptPreview = document.getElementById('gcash-preview');

checkoutBtn.addEventListener('click', ()=>{
  if(cart.length===0){ alert('Cart is empty!'); return; }
  checkoutModal.style.display='flex'; modalPayment.value=''; gcashInfo.style.display='none'; receiptInput.value=''; receiptPreview.innerHTML='';
});
closeCheckout.addEventListener('click', ()=>{ checkoutModal.style.display='none'; });
modalPayment.addEventListener('change', ()=>{ gcashInfo.style.display=modalPayment.value==='GCash'?'block':'none'; receiptInput.value=''; receiptPreview.innerHTML=''; });

receiptInput.addEventListener('change', ()=>{
  receiptPreview.innerHTML='';
  Array.from(receiptInput.files).slice(0,2).forEach(file=>{
    const reader = new FileReader();
    reader.onload=e=>{ const img=document.createElement('img'); img.src=e.target.result; receiptPreview.appendChild(img); };
    reader.readAsDataURL(file);
  });
});

document.getElementById('confirm-checkout').addEventListener('click', ()=>{
  const customerName = document.getElementById('customer-name').value.trim();
  const customerContact = document.getElementById('customer-contact').value.trim();
  if(customerName===''){ alert('Please enter your full name'); return; }
  if(customerContact===''){ alert('Please enter your contact number'); return; }

  if(modalPayment.value===''){ alert('Please select a payment method'); return; }
  if(modalPayment.value==='GCash' && receiptInput.files.length<1){ alert('Please upload at least 1 GCash receipt!'); return; }

  const receiptsData=[];
  if(modalPayment.value==='GCash'){
    const files=Array.from(receiptInput.files).slice(0,2);
    let loaded=0;
    files.forEach(file=>{
      const reader=new FileReader();
      reader.onload=e=>{ receiptsData.push(e.target.result); loaded++; if(loaded===files.length) finalizeOrder(); };
      reader.readAsDataURL(file);
    });
  } else finalizeOrder();

function finalizeOrder(){
  const order = {
    id: Date.now(),
    items: cart,
    subtotal: cart.reduce((acc,item)=>acc+item.price*item.qty,0),
    deliveryFee: DELIVERY_FEE,
    total: cart.reduce((acc,item)=>acc+item.price*item.qty,0)+DELIVERY_FEE,
    paymentMethod: modalPayment.value,
    location: selectedCoords ? {lat:selectedCoords.lat,lng:selectedCoords.lng} : {lat:BUSINESS_LAT,lng:BUSINESS_LNG},
    receipts: receiptsData,
    date: new Date().toISOString(),
    status: 'pending',
    customerName: customerName,
    customerContact: customerContact
  };
  let orders = JSON.parse(localStorage.getItem('orders')) || [];
  orders.push(order);
  localStorage.setItem('orders', JSON.stringify(orders));
  checkoutModal.style.display = 'none';
  cart = []; saveAndRender();
  window.location.href = 'orders.html';
  }
});
</script>
</body>
</html>
