<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flavour Food Bites - Login</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
/* ===== Base Styles ===== */
* { margin:0; padding:0; box-sizing:border-box; }
:root {
  --primary-color:#FF6B35; --primary-dark:#E55A2B; --secondary-color:#2C3E50;
  --accent-color:#3498DB; --success-color:#27AE60; --warning-color:#F39C12; --danger-color:#E74C3C;
  --surface:#FFFFFF; --background:#0F0F23; --background-light:#1a1a3a; --text-primary:#FFFFFF;
  --text-secondary:#B8BCC8; --text-muted:#7A7D85; --glass-bg:rgba(255,255,255,0.1);
  --glass-border:rgba(255,255,255,0.2); --shadow-glow:0 0 40px rgba(255,107,53,0.3);
  --gradient-primary:linear-gradient(135deg,#FF6B35 0%,#E55A2B 50%,#FF8A50 100%);
  --gradient-glass:linear-gradient(145deg,rgba(255,255,255,0.1)0%,rgba(255,255,255,0.05)100%);
}
body {
  font-family:'Inter',sans-serif;
  background:var(--background);
  color:var(--text-primary);
  line-height:1.6;
  overflow-x:hidden;
  display:flex;
  flex-direction:column;
}
body::before {
  content:''; position:fixed; top:0; left:0; width:100%; height:100%;
  background:
    radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.15)0%,transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(52, 152, 219, 0.15)0%,transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(39, 174, 96, 0.1)0%,transparent 50%),
    linear-gradient(135deg,#0F0F23 0%,#1a1a3a 100%);
  z-index:-2;
  animation:backgroundPulse 12s ease-in-out infinite;
}
@keyframes backgroundPulse {
  0%,100%{filter:brightness(1) saturate(1);}
  50%{filter:brightness(1.1) saturate(1.2);}
}
.main-container {
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:120px 2rem 4rem;
  min-height:100vh;
  position:relative;
}
.form-container {
  background:var(--glass-bg);
  backdrop-filter:blur(30px);
  border:1px solid var(--glass-border);
  border-radius:24px;
  padding:3rem;
  width:100%;
  max-width:450px;
  text-align:center;
  animation:slideInUp 0.8s ease-out;
  position:relative;
  overflow:hidden;
}
.form-container::before {
  content:''; position:absolute; top:0; left:0; right:0; bottom:0;
  background:var(--gradient-glass); opacity:0.5; z-index:-1;
}
.form-logo {
  width:80px; height:80px; background:var(--gradient-primary);
  border-radius:20px; display:flex; align-items:center; justify-content:center;
  font-size:2.5rem; color:white; margin:0 auto 1.5rem;
  box-shadow:0 0 40px rgba(255,107,53,0.3);
}
.form-title {
  font-size:2.5rem; font-weight:800; background:var(--gradient-primary);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  margin-bottom:0.5rem; letter-spacing:-1px;
}
.form-subtitle { color:var(--text-secondary); font-size:1.1rem; margin-bottom:2rem; }
.form-group { position:relative; margin-bottom:1rem; }
.form-label { display:block; color:var(--text-primary); font-weight:600; margin-bottom:0.5rem; font-size:0.9rem; text-transform:uppercase; letter-spacing:0.5px; }
.form-input {
  width:100%; padding:1rem 1rem 1rem 3rem; background:var(--background-light);
  border:1px solid var(--glass-border); border-radius:12px; color:var(--text-primary);
  font-size:1rem; transition:all 0.3s ease; backdrop-filter:blur(10px);
}
.input-icon {
  position:absolute; left:1rem; top:50%; transform:translateY(-50%);
  color:var(--text-muted); font-size:1.1rem; margin-top:12px;
}
.password-toggle {
  position:absolute; right:1rem; top:50%; transform:translateY(-50%);
  color:var(--text-muted); cursor:pointer; font-size:1.1rem; margin-top:12px;
}
.form-button {
  width:100%; padding:1.25rem; background:var(--gradient-primary);
  color:white; border:none; border-radius:12px; font-size:1.1rem;
  font-weight:700; cursor:pointer; transition:all 0.3s ease;
  display:flex; align-items:center; justify-content:center; gap:0.75rem;
  position:relative; overflow:hidden;
}
.form-button:hover { transform:translateY(-3px); box-shadow:0 15px 40px rgba(255,107,53,0.4); }
.form-footer { margin-top:1.5rem; text-align:center; display:flex; justify-content:space-between; }
.form-link { color:var(--text-secondary); text-decoration:none; font-size:0.9rem; transition:all 0.3s ease; cursor:pointer; }
.form-link:hover { color:var(--primary-color); }
.error-message,.success-message,.info-message {
  padding:1rem; border-radius:12px; font-size:0.9rem; display:none; margin-top:1rem;
}
.error-message{ background:rgba(231,76,60,0.1); border:1px solid #E74C3C; color:#E74C3C; }
.success-message{ background:rgba(39,174,96,0.1); border:1px solid #27AE60; color:#27AE60; }
.info-message{ background:rgba(52,152,219,0.1); border:1px solid #3498DB; color:#3498DB; }
@keyframes slideInUp {
  from{opacity:0;transform:translateY(30px);}
  to{opacity:1;transform:translateY(0);}
}
</style>
</head>
<body>

<main class="main-container">
  <div class="form-container" id="formContainer">
    <div class="form-logo"><i class="fas fa-utensils"></i></div>
    <h1 class="form-title" id="formTitle">Welcome Back</h1>
    <p class="form-subtitle" id="formSubtitle">Sign in to your account to continue ordering</p>

    <!-- Login -->
    <div id="loginForm">
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email">
        <i class="fas fa-user input-icon"></i>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password">
        <i class="fas fa-lock input-icon"></i>
        <i class="fas fa-eye password-toggle" id="loginPasswordToggle"></i>
      </div>
      <button class="form-button" id="loginBtn">Sign In</button>
    </div>

    <!-- Register -->
    <div id="registerForm" style="display:none;">
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="registerEmail" class="form-input" placeholder="Enter your email">
        <i class="fas fa-user input-icon"></i>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="registerPassword" class="form-input" placeholder="Enter your password">
        <i class="fas fa-lock input-icon"></i>
        <i class="fas fa-eye password-toggle" id="registerPasswordToggle"></i>
      </div>
      <button class="form-button" id="registerBtn">Register</button>
    </div>

    <!-- Forgot Password -->
    <div id="forgotForm" style="display:none;">
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="forgotEmail" class="form-input" placeholder="Enter your registered email">
        <i class="fas fa-envelope input-icon"></i>
      </div>
      <button class="form-button" id="sendOTPBtn">Send OTP</button>
      <div class="info-message" id="otpSentMessage"></div>

      <div class="form-group" style="margin-top:1rem;">
        <label>OTP</label>
        <input type="text" id="forgotOTP" class="form-input" placeholder="Enter OTP">
        <i class="fas fa-key input-icon"></i>
      </div>
      <div class="form-group">
        <label>New Password</label>
        <input type="password" id="forgotNewPassword" class="form-input" placeholder="Enter new password">
        <i class="fas fa-lock input-icon"></i>
      </div>
      <button class="form-button" id="verifyOTPBtn">Verify & Reset</button>
    </div>

    <!-- Footer -->
    <div class="form-footer">
      <span class="form-link" id="linkForgot">Forgot Password?</span>
      <span class="form-link" id="linkRegister">Register</span>
      <span class="form-link" id="linkLoginFromOther" style="display:none;">Back to Login</span>
    </div>
  </div>
</main>

<!-- Same CSS and HTML as your current login.html -->
<!-- Added live register and login integration with Vercel API -->
<script>
// Password toggle function
function togglePassword(inputId, toggleId) {
  const input = document.getElementById(inputId);
  const toggle = document.getElementById(toggleId);
  toggle.addEventListener("click", () => {
    input.type = input.type === "password" ? "text" : "password";
  });
}
togglePassword("loginPassword", "loginPasswordToggle");
togglePassword("registerPassword", "registerPasswordToggle");

// Form references
const loginForm = document.getElementById("loginForm");
const registerForm = document.getElementById("registerForm");
const forgotForm = document.getElementById("forgotForm");
const formTitle = document.getElementById("formTitle");
const formSubtitle = document.getElementById("formSubtitle");
const linkForgot = document.getElementById("linkForgot");
const linkRegister = document.getElementById("linkRegister");
const linkLoginFromOther = document.getElementById("linkLoginFromOther");
const otpSentMessage = document.getElementById("otpSentMessage");

// Toggle forms
linkForgot.onclick = () => {
  loginForm.style.display = "none";
  registerForm.style.display = "none";
  forgotForm.style.display = "block";
  formTitle.innerText = "Forgot Password";
  formSubtitle.innerText = "Enter your registered email to receive OTP";
  linkForgot.style.display = "none";
  linkRegister.style.display = "none";
  linkLoginFromOther.style.display = "inline";
  otpSentMessage.style.display = "none";
};

linkRegister.onclick = () => {
  loginForm.style.display = "none";
  registerForm.style.display = "block";
  forgotForm.style.display = "none";
  formTitle.innerText = "Register";
  formSubtitle.innerText = "Create a new account";
  linkForgot.style.display = "none";
  linkRegister.style.display = "none";
  linkLoginFromOther.style.display = "inline";
  otpSentMessage.style.display = "none";
};

linkLoginFromOther.onclick = () => {
  loginForm.style.display = "block";
  registerForm.style.display = "none";
  forgotForm.style.display = "none";
  formTitle.innerText = "Welcome Back";
  formSubtitle.innerText = "Sign in to your account to continue ordering";
  linkForgot.style.display = "inline";
  linkRegister.style.display = "inline";
  linkLoginFromOther.style.display = "none";
  otpSentMessage.style.display = "none";
};

// ===== Register =====
document.getElementById("registerBtn").addEventListener("click", async () => {
  const email = document.getElementById("registerEmail").value.trim();
  const password = document.getElementById("registerPassword").value.trim();
  if (!email || !password) return alert("Please fill all fields");

  try {
    const res = await fetch("/api/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });
    const data = await res.json();
    if (data.success) {
      alert("Registration successful! You can now login.");
      linkLoginFromOther.click();
    } else {
      alert(data.message || "Registration failed");
    }
  } catch {
    alert("Server error. Try again.");
  }
});

// ===== Login =====
document.getElementById("loginBtn").addEventListener("click", async () => {
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value.trim();
  if (!email || !password) return alert("Please fill all fields");

  try {
    const res = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });
    const data = await res.json();
    if (data.success) {
      alert("Login successful!");
      window.location.href = "index.html";
    } else {
      alert(data.message || "Invalid email or password");
    }
  } catch {
    alert("Server error. Try again.");
  }
});

// ===== OTP functionality =====
document.getElementById("sendOTPBtn").addEventListener("click", async () => {
  const email = document.getElementById("forgotEmail").value.trim();
  if (!email) return alert("Please enter your email");

  const otp = Math.floor(100000 + Math.random() * 900000);

  try {
    const res = await fetch("/api/send-otp", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, otp }),
    });
    const data = await res.json();
    if (data.success) {
      otpSentMessage.innerText = data.message;
      otpSentMessage.className = "info-message";
      otpSentMessage.style.display = "block";
    } else {
      otpSentMessage.innerText = data.error || "Failed to send OTP";
      otpSentMessage.className = "error-message";
      otpSentMessage.style.display = "block";
    }
  } catch {
    otpSentMessage.innerText = "Server error. Try again.";
    otpSentMessage.className = "error-message";
    otpSentMessage.style.display = "block";
  }
});

document.getElementById("verifyOTPBtn").addEventListener("click", async () => {
  const email = document.getElementById("forgotEmail").value.trim();
  const otp = document.getElementById("forgotOTP").value.trim();
  const newPass = document.getElementById("forgotNewPassword").value.trim();
  if (!email || !otp || !newPass) return alert("All fields are required");

  try {
    const res = await fetch("/api/verify-otp", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, otp }),
    });
    const data = await res.json();
    if (data.success) {
      alert("OTP verified! Password reset successful (mock).");
      linkLoginFromOther.click();
    } else {
      alert(data.message || "Invalid OTP");
    }
  } catch {
    alert("Server error. Try again.");
  }
});
</script>

</body>
</html>
